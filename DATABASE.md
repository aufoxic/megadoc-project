# DATABASE.md
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö MegaDoc (MySQL)

## üìå –û–±—â–∞—è —Å—Ö–µ–º–∞

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏—Ö —Ä–∞–±–æ—Ç—É –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–µ—Ç–æ–∫, —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## üóÇ –¢–∞–±–ª–∏—Ü—ã

### –¢–∞–±–ª–∏—Ü–∞ `branches`
–°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö –≤–µ—Ç–∫–∞—Ö —Å–∏—Å—Ç–µ–º—ã.
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
| :--- | :--- | :--- | :--- |
| `id` | `VARCHAR(50)` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–µ—Ç–∫–∏ (—á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π) | `PRIMARY KEY` |
| `name` | `VARCHAR(255)` | –ù–∞–∑–≤–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ | `NOT NULL` |
| `description` | `TEXT` | –û–ø–∏—Å–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ | |
| `parent_id` | `VARCHAR(50)` | ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –≤–µ—Ç–∫–∏ | `FOREIGN KEY REFERENCES branches(id)` |
| `is_visible` | `BOOLEAN` | –§–ª–∞–≥ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤–µ—Ç–∫–∏ | `DEFAULT TRUE` |
| `sort_order` | `INT` | –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å—Ä–µ–¥–∏ –≤–µ—Ç–æ–∫ –æ–¥–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è | `DEFAULT 0` |
| `created_at` | `DATETIME` | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è | `DEFAULT CURRENT_TIMESTAMP` |
| `updated_at` | `DATETIME` | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` |
| `created_by` | `BIGINT` | user_id —Å–æ–∑–¥–∞—Ç–µ–ª—è –≤–µ—Ç–∫–∏ | `NOT NULL` |

### –¢–∞–±–ª–∏—Ü–∞ `branch_tags`
–°–≤—è–∑—å "–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º" –º–µ–∂–¥—É –≤–µ—Ç–∫–∞–º–∏ –∏ —Ç–µ–≥–∞–º–∏. –†–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
| :--- | :--- | :--- | :--- |
| `branch_id` | `VARCHAR(50)` | ID –≤–µ—Ç–∫–∏ | `FOREIGN KEY, PRIMARY KEY` |
| `tag` | `VARCHAR(255)` | –¢–µ–∫—Å—Ç —Ç–µ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "#KAP") | `PRIMARY KEY` |

### –¢–∞–±–ª–∏—Ü–∞ `messages`
–•—Ä–∞–Ω–∏—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –≤–µ—Ç–∫–∞–º.
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
| :--- | :--- | :--- | :--- |
| `id` | `VARCHAR(255)` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–æ–±—â–µ–Ω–∏—è (UUID) | `PRIMARY KEY` |
| `branch_id` | `VARCHAR(50)` | ID –≤–µ—Ç–∫–∏, –∫ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏–≤—è–∑–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ | `FOREIGN KEY NOT NULL` |
| `user_id` | `BIGINT` | user_id –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–∏–∑ Telegram) | `NOT NULL` |
| `content` | `TEXT` | –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è | `NOT NULL` |
| `type` | `ENUM(...)` | –¢–∏–ø: 'message', 'decision', 'problem', 'idea' | `DEFAULT 'message'` |
| `reply_to_id` | `VARCHAR(255)` | ID —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –¥–∞–Ω –æ—Ç–≤–µ—Ç | `FOREIGN KEY` |
| `timestamp` | `DATETIME` | –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ | `DEFAULT CURRENT_TIMESTAMP` |

### –¢–∞–±–ª–∏—Ü–∞ `users`
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –±–æ—Ç–∞.
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
| :--- | :--- | :--- | :--- |
| `id` | `BIGINT` | user_id –∏–∑ Telegram | `PRIMARY KEY` |
| `username` | `VARCHAR(255)` | @username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | |
| `first_name` | `VARCHAR(255)` | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | |
| `role` | `ENUM('admin','moderator','user')` | –†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ | `DEFAULT 'user'` |

## ‚öôÔ∏è –¢—Ä–∏–≥–≥–µ—Ä—ã –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã (–¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∂–µ)

-   **`prevent_cyclic_branch`**: –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º `parent_id`.
-   **`update_branch_children`**: –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—á–µ—Ä–Ω–∏—Ö –≤–µ—Ç–æ–∫.

## üîó –°–≤—è–∑–∏ –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

-   –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤–µ—Ç–∫–∏ –≤—Å–µ –µ—ë —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —É–¥–∞–ª—è—Ç—å—Å—è (`ON DELETE CASCADE`).
-   –ü–æ–ª–µ `parent_id` –¥–æ–ª–∂–Ω–æ —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –≤–µ—Ç–∫—É –∏–ª–∏ –±—ã—Ç—å `NULL` (–¥–ª—è –∫–æ—Ä–Ω–µ–≤—ã—Ö –≤–µ—Ç–æ–∫).

---
*–î–æ–∫—É–º–µ–Ω—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –û–±–Ω–æ–≤–ª—ë–Ω: 28.08.2025*
